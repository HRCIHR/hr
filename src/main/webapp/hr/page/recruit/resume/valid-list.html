<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-trasitional.dtd">
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>My JSP 'position-release_details.jsp' starting page</title>

		<script type="application/javascript" src="../../../../easyui/jquery.min.js"></script>

		<script type="application/javascript" src="../../../../easyui/jquery.easyui.min.js"></script>
		<script type="application/javascript" src="../../../../easyui/easyui-lang-zh_CN.js"></script>
		<link rel="stylesheet" href="../../../../easyui/themes/icon.css" />
		<link rel="stylesheet" href="../../../../easyui/themes/default/easyui.css" />

	</head>
	<script>
		function fuhe(datas) {

			console.log(datas);

			//给下拉框赋值
			setTimeout(function() {
				$('#addzhiweiClass').combobox('select', datas.ConfigMajor.configMajorKind.majorKindId);
				$('#zhaopinType').combobox('select', datas.engage_Type);
				$('#addzhiweiName').combobox('select', datas.ConfigMajor.majorId);
				$("#sex").combobox('select', datas.human_Sex);
				$("#guoji").combobox('select', datas.human_Nationality);
				$("#mingzu").combobox('select', datas.human_Race);
				$("#zongjiao").combobox('select', datas.human_Religion);
				$("#zhengzhimianmao").combobox('select', datas.human_Party);
				$("#xueli").combobox('select', datas.human_Educated_Degree);
				$("#jiaoyunianxian").combobox('select', datas.human_Educated_Years);
				$("#zhuanye").combobox('select', datas.human_Educated_Major);
				$("#techang").combobox('select', datas.human_Specility);
				$("#aihao").combobox('select', datas.human_Hobby);

				$("#human_Name").textbox("setValue", datas.human_Name);

				$("#human_Homephone").textbox("setValue", datas.human_Homephone);

				$("#human_Mobilephone").textbox("setValue", datas.human_Mobilephone);
				$("#human_Telephone").textbox("setValue", datas.human_Telephone);

				$("#human_Address").textbox("setValue", datas.human_Address);
				$("#human_Postcode").textbox("setValue", datas.human_Postcode);
				$("#human_Birthplace").textbox("setValue", datas.human_Birthplace);
				$("#resid").val(datas.res_Id);
				$("#human_Idcard").textbox("setValue", datas.human_Idcard);
				//human_Age  human_College human_History_Records remark
				$("#human_Age").textbox("setValue", datas.human_Age);
				$("#human_College").textbox("setValue", datas.human_College);
				$("#human_History_Records").textbox("setValue", datas.human_History_Records);
				$("#remark").textbox("setValue", datas.remark);
				//registerTime  bri
				$('#bri').datetimebox('setValue', datas.human_Birthday);
				$('#regist_Time').datetimebox('setValue', datas.regist_Time);

			}, 100);

			$('#Resumedialog').dialog("open");
		}
		$(function() {

			$("#updatetijiao").on("click", function() {
				$("#updateform").form('submit', {
					url: "http://127.0.0.1:8080/HR/Resume/updateResume",
					onSubmit: function(param) {

					},
					success: function(data) {
						if(data) {
							$.messager.alert('提示信息', '修改成功!', 'info', function() {

								location.reload();
							});
							//关闭模态框 清除模态框数据clear

						} else {
							$.messager.alert('提示信息', '修改失败 请检查输入是否有误!', 'error');
						}
					}
				});

			})

			//			$("#zhiweiClass").combobox({
			//				url: 'http://127.0.0.1:8080/HR/MajorKind/queryMajorKind',
			//				valueField: "majorKindId",
			//				method: "get",
			//				textField: "majorKindName",
			//				onSelect: function(record) {
			//					console.log(record);
			//					$("#zhiweiName").combobox({
			//						url: 'http://127.0.0.1:8080/HR/Major/QueryMajor?majorKindId=' + record.majorKindId,
			//						valueField: "majorId",
			//						method: "get",
			//						textField: "majorName"
			//					})
			//				}
			//			});
			$("#zhaopinType").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=招聘类型',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#guoji").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=国籍',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#mingzu").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=民族',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#zhengzhimianmao").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=政治面貌',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#xueli").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=学历',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#jiaoyunianxian").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=教育年限',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#zhuanye").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=专业',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#techang").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=特长',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#aihao").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=爱好',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});
			$("#zongjiao").combobox({
				url: 'http://127.0.0.1:8080/HR/PublicChar/queryPublicChar?type=宗教信仰',
				valueField: "attributeName",
				method: "get",
				textField: "attributeName"
			});

			//Resumedialog
			$('#Resumedialog').dialog({
				title: "简历复核",
				width: 800,
				height: 600,
				shadow: true,
				closed: true
			});

			$("#searchbut").on("click", function() {
				var MajorId = $('#searchzhiweiName').textbox("getValue");
				var keyword = $('#keyword').textbox("getValue");
				var status = $('#status').val();
				var begin = $('#begin').datetimebox('getValue');
				var finish = $('#finish').datetimebox('getValue');

				if(begin == "") {
					begin = "1899-11-30 00:00";
				}
				if(finish == "") {
					finish = "2300-11-30 00:00";
				}
				//				alert(MajorId + keyword + status + begin + finish);
				var newurl = "http://127.0.0.1:8080/HR/Resume/queryResumeByCase";
				$('#resumetable').datagrid({
					url: newurl,
					method: "post",
					queryParams: {
						MajorId: MajorId,
						keyword: keyword,
						status: status,
						begin: begin,
						finish: finish
					}
				});

			})
			//			$("#searchbut").on("click", function() {
			//				url: "xxx",
			//				$('#searchfrom').form('submit', {
			//					onSubmit: function(param) {
			//						console.log(param);
			//						return false;
			//					}
			//				});
			//			})

			//MajorKind/queryMajorKind 职位分类 zhiweiClass ===>zhiweiName
			$(".zhiweiClass").combobox({
				url: 'http://127.0.0.1:8080/HR/MajorKind/queryMajorKind',
				valueField: "majorKindId",
				method: "get",
				textField: "majorKindName",
				onSelect: function(record) {
					console.log(record);
					$(".zhiweiName").combobox({
						url: 'http://127.0.0.1:8080/HR/Major/QueryMajor?majorKindId=' + record.majorKindId,
						valueField: "majorId",
						method: "get",
						textField: "majorName"
					})
				}
			});
			$(".zhiweiName").combobox({})
			$('#resumetable').datagrid({
				url: 'http://127.0.0.1:8080/HR/Resume/queryResumeByCase',
				fitColumns: true,
				pagination: true,
				pageList: [5, 10],
				pageSize: 5,
				pageNumber: 1,
				method: "get",
				toolbar: '#tb',
				queryParams: {

					status: 1
					

				},
				loadFilter: function(data) {
					var newarray = new Array();

					for(a = 0; a < data.rows.length; a++) {

						var obj = new Object();

						obj.res_Id = data.rows[a].res_Id;
						obj.human_Name = data.rows[a].human_Name;
						obj.human_Sex = data.rows[a].human_Sex;
						obj.majorKindName = data.rows[a].ConfigMajor.configMajorKind.majorKindName;
						obj.majorName = data.rows[a].ConfigMajor.majorName;
						
						var interviewstatus = data.rows[a].ConfigMajor.interview_Status;
						if(interviewstatus * 1 > 0) {
							obj.interview_Status= "已面试";
						} else {
							obj.interview_Status= "待面试";
						}
						
						
						obj.human_Telephone = data.rows[a].human_Telephone;
						var status = data.rows[a].check_Status;
						if(status * 1 > 0) {
							obj.check_Status = "已复核";
						} else {
							obj.check_Status = "待复核";
						}

						obj.datas = data.rows[a];
						newarray.push(obj);
					}

					var rs = new Object();
					rs.total = data.total;
					rs.rows = newarray;

					console.log(rs);
					return rs;
				},

				columns: [
					[{
							field: 'res_Id',
							title: '档案编号',
							width: 187,
							align: 'right'
						}, {
							field: 'human_Name',
							title: '姓名',
							width: 187,
							align: 'right'
						}, {
							field: 'human_Sex',
							title: '性别',
							width: 187,
							align: 'right'
						},
						{
							field: 'majorKindName',
							title: '职位分类',
							width: 187,
							align: 'right'
						},
						{
							field: 'majorName',
							title: '职位名称',
							width: 187,
							align: 'right'
						},
						{
							field: 'human_Telephone',
							title: '电话号码',
							width: 187,
							align: 'right'
						},

						{
							field: 'check_Status',
							title: '复核状态',
							width: 187,
							align: 'right'
						},
						{
							field: 'interview_Status',
							title: '面试状态',
							width: 187,
							align: 'right'
				}
						//,
//						{
//							field: 'datas',
//							title: '操作',
//							width: 187,
//							align: 'right',
//							formatter: function(value, row, index) {
//								var datas = JSON.stringify(row.datas);
//								//								console.log(datas);
//								return "<button onClick='fuhe(" + datas + ")'>复核</button>"
//							}
//						}
					]
				]
			});
		})
	</script>

	<body>

		<table id="resumetable">
			<div id="tb" style="padding:2px 5px;">
				<form id="searchfrom" method="post">
					<input id="a" class="zhiweiClass" data-options="label:'职位分类'" class="easyui-combobox" style="width:300px">

					<input id="searchzhiweiName" class="zhiweiName" name="majorId" data-options="label:'职位名称'" class="easyui-combobox" style="width:300px">
					<input id="keyword" name="keyword" class="easyui-textbox" data-options="label:'关键字'" style="width:300px">

					<input id="begin" class="easyui-datetimebox" name="begin" data-options="required:true,showSeconds:false,label:'登记时间'" style="width:250px">至
					<input id="finish" class="easyui-datetimebox" name="finish" data-options="required:true,showSeconds:false" style="width:150px">


					<input id="status" type="hidden" value="1" name="status" />
					<input id="interview_Status" type="hidden" value="0" name="interview_Status" />
					<a href="#" id="searchbut" class="easyui-linkbutton" iconCls="icon-search">Search</a>
				</form>
			</div>
		</table>
		
	</body>

</html>